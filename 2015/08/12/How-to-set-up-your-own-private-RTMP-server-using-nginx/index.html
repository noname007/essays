<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>【译】How to set up your own private RTMP server using nginx | 焖</title>
  <meta name="author" content="yangzz">
  
  <meta name="description" content="如何使用nginx搭建一个私有的RTMP服务器原文地址: https://obsproject.com/forum/resources/how-to-set-up-your-own-private-rtmp-server-using-nginx.50/

大多数人喜欢使用Twitch.tv和Ustr">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="【译】How to set up your own private RTMP server using nginx"/>
  <meta property="og:site_name" content="焖"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/essays/favicon.png" rel="icon">
  <link rel="alternate" href="/essays/atom.xml" title="焖" type="application/atom+xml">
  <link rel="stylesheet" href="/essays/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/essays/">焖</a></h1>
  <h2><a href="/essays/">好习惯受益终生</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-08-12T09:20:51.000Z"><a href="/essays/2015/08/12/How-to-set-up-your-own-private-RTMP-server-using-nginx/">2015-08-12</a></time>
      
      
  
    <h1 class="title">【译】How to set up your own private RTMP server using nginx</h1>
  

    </header>
    <div class="entry">
      
        <h1 id="如何使用nginx搭建一个私有的RTMP服务器">如何使用nginx搭建一个私有的RTMP服务器</h1><blockquote><p>原文地址: <a href="https://obsproject.com/forum/resources/how-to-set-up-your-own-private-rtmp-server-using-nginx.50/" target="_blank" rel="external">https://obsproject.com/forum/resources/how-to-set-up-your-own-private-rtmp-server-using-nginx.50/</a></p>
</blockquote>
<p>大多数人喜欢使用Twitch.tv和Ustream这类服务把流视频转播放给用户，并且工作的也非常好。但是有时候你想对你的流视频有更多的控制权，或者你想其他人把视频流转发给你，或者你想转发视频流到多个地方，或者一些事情需要你有权限访问RTMP服务器上的视频流。这篇教程内容非常基础，教你在一台linux服务器上搭建一个简单的RTMP服务器。</p>
<p>在你自己RTMP服务器上，你可能感兴趣去做的是这两件事情：</p>
<ul>
<li>向多个频道播放内容</li>
<li>由于一些目的，把其他人的多个视频流合成一个（我在多个角度拍摄中使用它，例如像在<a href="https://www.youtube.com/watch?v=6WUU58POsTM" target="_blank" rel="external">这个多个拍摄角度视频中</a>）</li>
</ul>
<p>好的，你该怎样做到这些事情呢？</p>
<h2 id="第一步：获取一个服务器">第一步：获取一个服务器</h2><p>不管你信不信，RTMP 实际上对系统资源要求十分的小。本质上来说，它仅仅是从输入端抓取数据并把数据转发到输出端，简单的数据传输。不相信我？我的运行了很长一段时间的RTMP服务器是一个树莓派,一个价值35美金（月200元人民币）的迷你计算机，就放在我的办公桌上，至少同时处理3个数据输入流是完全没有问题的，我也从来没有对它进行过压力测试去看看到底他能处理多少。因此，我向你保证，即使一个便宜的旧机器也是完全没有问题的。</p>
<p>加入你没有树莓派，一个vps也是可以的。我推荐Linode服务商，加入你能支付的起服务费用。我现在也在使用，并且到现在为止，它也运行良好。仅仅确保你有足够的带宽。。。记住带宽的使用量是<code>（视频流的大小）* （上传人数+下载人数）</code>。因此当我有两个视频流推送视频流到我的服务器，并且我同时下载他们，两小时消耗了10GB的带宽流量。</p>
<p>为了方便，我推荐使用Ubuntu作为服务器软件，但是你完全可使用任何你想使用的。只要你能从apt之外其他的地方解决nginx的依赖问题，你就能参考这篇文档。</p>
<p><strong>Windows 用户注意</strong> 这边教程关注Linux上的使用，加入你想在Windows上使用，你能找到带有RTMP 模块的nginx二进制包，在这个地方： <a href="http://nginx-win.ecsds.eu/" target="_blank" rel="external">http://nginx-win.ecsds.eu/</a></p>
<p>加入你的服务器在你家里，你需要转发TCP 1935端口数据到这个服务器上。。。不同的路由器有不同的设置，因此你需要根据你自己的路由器，查看怎么设置端口转发。同时，我推荐使用 DynDNS 这类服务去克服家用主机动态IP的问题。</p>
<h2 id="第二步：安装nginx_和RTMP_模块">第二步：安装nginx 和RTMP 模块</h2><p>登录你的机器，并且确保你有这些必须的工具去编译nginx,执行下面的命令</p>
<pre><code>$ sudo apt-<span class="built_in">get</span> install build-essential libpcre3 libpcre3-<span class="built_in">dev</span> libssl-<span class="built_in">dev</span>
</code></pre><p>现在说点关于nginx的一点小知识（发音 “engine-X”）。nginx是个轻量级的web server,<br>但是有些人为它写了一个RTMP模块，因此它能够提供RTMP流相关的服务，为了添加这个RTMP模块，我们必须重新从源码编译nginx 而不是使用apt包。不要担心，它是非常简单的，仅仅执行下面的指令:)</p>
<p>在你的home目录，下载nginx 源码：</p>
<pre><code><span class="variable">$ </span>wget <span class="symbol">http:</span>/<span class="regexp">/nginx.org/download</span><span class="regexp">/nginx-1.7.7.tar.gz</span>
</code></pre><p>在写这篇文章的时候，ngxin 最新的稳定版本是 1.7.7。你可是从(nginx 下载页)[<a href="http://nginx.org/en/download.html]下载最新的包。" target="_blank" rel="external">http://nginx.org/en/download.html]下载最新的包。</a></p>
<p>接着，从git 获取RTMP 模块的源代码</p>
<pre><code><span class="variable">$ </span>wget <span class="symbol">https:</span>/<span class="regexp">/github.com/arut</span><span class="regexp">/nginx-rtmp-module/archive</span><span class="regexp">/master.zip</span>
</code></pre><p>解压开他们，斌且进入nginx 目录：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf nginx-1.7.7.tar.gz&#10;$ unzip master.zip&#10;$ cd nginx-1.7.7</span><br></pre></td></tr></table></figure>
<p>现在，编译nginx:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure --with-http_ssl_module --add-module=../nginx-rtmp-module-master&#10;$ make&#10;$ sudo make install</span><br></pre></td></tr></table></figure>
<p>现在nginx 安装完毕了！默认安装在了 <code>/usr/local/nginx</code>,使用下面的命令启动：</p>
<pre><code>$ sudo <span class="regexp">/usr/</span>local<span class="regexp">/nginx/</span>sbin<span class="regexp">/nginx</span>
</code></pre><p>现在测试一下确认nginx 正在运行，打开浏览器输入 <code>http://服务器ip/</code> 然后你将看到”Welcome to nginx!”这个页面。</p>
<h2 id="第三步：配置nginx_启用RTMP">第三步：配置nginx 启用RTMP</h2><p>打开配置文件，默认在 /usr/local/nginx/conf/nginx.conf，在文件的最后添加下面的内容：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">rtmp</span> &#123;</span><br><span class="line">        <span class="title">server</span> &#123;</span><br><span class="line">                <span class="title">listen</span> <span class="number">1935</span>;</span><br><span class="line">                <span class="title">chunk_size</span> <span class="number">4096</span>;</span><br><span class="line"></span><br><span class="line">                <span class="title">application</span> live &#123;</span><br><span class="line">                        <span class="title">live</span> <span class="built_in">on</span>;</span><br><span class="line">                        <span class="title">record</span> <span class="built_in">off</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是一个非常简单的基础配置，有一个live应用，它将会把RTMP视频流转发给所有请求这它的用户。你可能过一会才播放这个视频。<a href="https://github.com/arut/nginx-rtmp-module/wiki/Directives" target="_blank" rel="external">这里是所有配置选项</a>，展示了如何转发视频流到其他的地方（像Twitch），保存上传的记录，输出状态，等等。。</p>
<p>重启nginx:</p>
<pre><code>$ sudo <span class="regexp">/usr/</span>local<span class="regexp">/nginx/</span>sbin/nginx -s stop
$ sudo <span class="regexp">/usr/</span>local<span class="regexp">/nginx/</span>sbin/nginx
</code></pre><h2 id="第四步：测试">第四步：测试</h2><p>你的服务器应该能接受RTMP视频流了。让我们尝试一下吧。<br>创建一个新的工程在OBS,并且更改 Broadcast Settings 为如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Streaming Service: Custom&#10;Server: rtmp://&#60;your server ip&#62;/live&#10;Play Path/Stream Key: test</span><br></pre></td></tr></table></figure>
<p>你可能会对test路径从哪里来的产生疑惑。好吧，我们就是刚刚穿创建的。你能创建任何路径和流，并且把那个路径发到RTMP播放器里面，并且并且它将重放。出于简单的目的，授权是没必要的。然而，授权是可以支持的，后面再做介绍。</p>
<p>你现在能向你的服务器推送视频流了。你点击了 “Start Streaming”  并且没有报告错误，这是一个好的信号。</p>
<p>怎么打开观看呢？<br>vMix<br>使用vlc: rtmp://<your server="" ip="">/live/test</your></p>
<h2 id="现在做什么呢？">现在做什么呢？</h2><p>你能使用使你的服务器转发视频流到其他的流服务和频道。在”record off;”后面添加下面的指令。</p>
<pre><code><span class="keyword">push </span>rtmp://&lt;other <span class="keyword">streaming </span>service rtmp url&gt;/&lt;<span class="keyword">stream </span>key&gt;
</code></pre><p>任何视频流都会被转发，同时会转发个客户端，你可以添加多个push指令。</p>
<h2 id="FAQ">FAQ</h2>
      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/essays/tags/nginx/">nginx</a>, <a href="/essays/tags/rtmp/">rtmp</a>, <a href="/essays/tags/翻译/">翻译</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://noname007.github.io/essays/2015/08/12/How-to-set-up-your-own-private-RTMP-server-using-nginx/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:noname007.github.io/essays">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/essays/tags/draft/">draft</a><small>0</small></li>
  
    <li><a href="/essays/tags/erlang/">erlang</a><small>1</small></li>
  
    <li><a href="/essays/tags/git/">git</a><small>1</small></li>
  
    <li><a href="/essays/tags/linux/">linux</a><small>1</small></li>
  
    <li><a href="/essays/tags/nginx/">nginx</a><small>1</small></li>
  
    <li><a href="/essays/tags/ngxin/">ngxin</a><small>1</small></li>
  
    <li><a href="/essays/tags/php/">php</a><small>1</small></li>
  
    <li><a href="/essays/tags/rtmp/">rtmp</a><small>1</small></li>
  
    <li><a href="/essays/tags/swoole/">swoole</a><small>0</small></li>
  
    <li><a href="/essays/tags/总结/">总结</a><small>0</small></li>
  
    <li><a href="/essays/tags/札记/">札记</a><small>0</small></li>
  
    <li><a href="/essays/tags/翻译/">翻译</a><small>1</small></li>
  
    <li><a href="/essays/tags/草稿/">草稿</a><small>0</small></li>
  
    <li><a href="/essays/tags/读书笔记/">读书笔记</a><small>1</small></li>
  
    <li><a href="/essays/tags/配置/">配置</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 yangzz
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/essays/js/jquery.imagesloaded.min.js"></script>
<script src="/essays/js/gallery.js"></script>




<link rel="stylesheet" href="/essays/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/essays/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>